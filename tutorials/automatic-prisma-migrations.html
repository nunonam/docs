<!DOCTYPE html><html lang="en"><head><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="#262626" name="theme-color"/><link rel="mask-icon" href="/favicon.svg" color="#262626"/><script>!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="gURNntij37hKxpSUjda9znzNaOxZBG6H";;analytics.SNIPPET_VERSION="4.15.3";
analytics.load("gURNntij37hKxpSUjda9znzNaOxZBG6H");
analytics.page();
}}();</script><link rel="preload" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" as="style"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement;d.classList.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';d.classList.add('dark')}else{d.style.colorScheme = 'light';d.classList.add('light')}}else if(e){d.classList.add(e|| '')}else{d.classList.add('dark')}if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'dark'}catch(e){}}()</script><link rel="shortcut icon" href="/favicon_system.svg" sizes="any" type="image/svg+xml"/><title>Automatic Prisma migrations - Documentation - ChattyCloud</title><meta name="msapplication-TileColor" content="#da532c"/><meta name="description" content="To ensure PlanetScale works well with the Prisma development process, we implemented the ability to automatically copy Prisma migration metadata as part of our deployment process."/><meta property="og:url" content="https://docs.chatty-cloud.com/tutorials/automatic-prisma-migrations"/><meta property="og:image" content="https://docs.chatty-cloud.com//img/internals/social_share.png"/><meta property="og:type" content="website"/><meta property="og:title" content="Automatic Prisma migrations - Documentation - ChattyCloud"/><meta property="og:description" content="To ensure PlanetScale works well with the Prisma development process, we implemented the ability to automatically copy Prisma migration metadata as part of our deployment process."/><meta name="twitter:url" content="https://docs.chatty-cloud.com/tutorials/automatic-prisma-migrations"/><meta name="twitter:image" content="https://docs.chatty-cloud.com//img/internals/social_share.png"/><meta name="twitter:title" content="Automatic Prisma migrations - Documentation - ChattyCloud"/><meta name="twitter:description" content="To ensure PlanetScale works well with the Prisma development process, we implemented the ability to automatically copy Prisma migration metadata as part of our deployment process."/><script type="application/ld+json">{&quot;@context&quot;:&quot;http://schema.org&quot;,&quot;@type&quot;:&quot;Organization&quot;,&quot;name&quot;:&quot;ChattyCloud, Inc.&quot;,&quot;url&quot;:&quot;https://docs.chatty-cloud.com&quot;,&quot;sameAs&quot;:[&quot;https://twitter.com/&quot;],&quot;address&quot;:{&quot;@type&quot;:&quot;PostalAddress&quot;,&quot;streetAddress&quot;:&quot;321 Castro St #200&quot;,&quot;addressLocality&quot;:&quot;Mountain View&quot;,&quot;addressRegion&quot;:&quot;CA&quot;,&quot;postalCode&quot;:&quot;94041&quot;,&quot;addressCountry&quot;:&quot;US&quot;}}</script><meta name="next-head-count" content="18"/><link rel="preload" href="/docs/_next/static/css/d19452855f080e47.css" as="style"/><link rel="stylesheet" href="/docs/_next/static/css/d19452855f080e47.css" data-n-g=""/><link rel="preload" href="/docs/_next/static/css/6ed6fc696efb435c.css" as="style"/><link rel="stylesheet" href="/docs/_next/static/css/6ed6fc696efb435c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/docs/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/docs/_next/static/chunks/webpack-21775410f7f02689.js" defer=""></script><script src="/docs/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/docs/_next/static/chunks/main-d78ee85becc0fade.js" defer=""></script><script src="/docs/_next/static/chunks/pages/_app-4f84c90584aacdb0.js" defer=""></script><script src="/docs/_next/static/chunks/217-13521f692b432699.js" defer=""></script><script src="/docs/_next/static/chunks/228-546d180dcfb89379.js" defer=""></script><script src="/docs/_next/static/chunks/476-dd807cdaa38948ef.js" defer=""></script><script src="/docs/_next/static/chunks/pages/%5Bcategory%5D/%5Bpost%5D-0dfa5a716bfbcb43.js" defer=""></script><script src="/docs/_next/static/ffRgkaqinJ87gnfSh8k4z/_buildManifest.js" defer=""></script><script src="/docs/_next/static/ffRgkaqinJ87gnfSh8k4z/_ssgManifest.js" defer=""></script><script src="/docs/_next/static/ffRgkaqinJ87gnfSh8k4z/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="h-full"><div class="flex flex-col mx-auto bg-primary text-primary"><a href="#content" class="absolute z-50 px-2 py-1 border-b border-r rounded-br -ml-96 focus:ml-0 bg-secondary">Skip to content</a><div class="relative z-40 w-full py-3 mx-auto border-b bg-primary text-primary"><div class="md:hidden duration-300 fixed z-30 inset-0 transition-opacity opacity-0 pointer-events-none" aria-hidden="true"><div class="absolute inset-0 bg-primary"></div></div><header class="relative z-50 grid items-center grid-cols-2 px-3 mx-auto md:grid-cols-3 md:grid-rows-1 max-w-7xl sm:px-6 lg:px-8"><div class="flex items-center col-start-1 row-start-1"><a class="rounded text-primary" aria-label="Go to documentation homepage" href="https://chatty-cloud.com"><svg width="41" height="32" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 41 32"><path d="M106.967+511.808C106.967+423.665+178.421+352.211+266.564+352.211C354.708+352.211+426.162+423.665+426.162+511.808C426.162+599.951+354.708+671.406+266.564+671.406C178.421+671.406+106.967+599.951+106.967+511.808Z" fill="currentColor"></path></svg></a><div class="flex items-center lg:text-lg font-medium pl-1.5"><a class="text-primary" href="/docs">Documentation</a></div></div><div class="col-start-1 col-span-2 md:col-span-1 pt-3 md:pt-0 row-start-3 md:col-start-2 md:row-start-1 md:flex hidden"><input type="search" class="w-full leading-[1.5rem] px-1.5 rounded ring-offset-0 border shadow-sm text-base py-sm focus-ring bg-secondary text-primary border-secondary" id="searchbox" placeholder="Search documentation"/></div><div class="col-start-1 col-span-2 md:col-span-1 row-start-2 pt-5 md:pt-0 md:row-start-1 md:col-start-3 md:justify-end md:flex hidden"><a href="https://dashboard.chatty-cloud.com" class="mr-2 box-border relative inline-flex items-center justify-center text-center no-underline leading-none whitespace-nowrap font-semibold rounded flex-shrink-0 transition select-none overflow-hidden focus-ring text-primary hover:bg-secondary focus:border-blue-500 border border-gray-200 dark:border-gray-600 bg-primary h-button py-1.5 px-2">dashboard</a></div><div class="relative z-50 flex justify-end col-start-2 row-start-1 align-center md:hidden"><button aria-label="Open navigation menu" class="flex appearance-none focus:outline-none"><span class="HamburgerMenu_menuWrapper__TCSWe" data-open="false"><span class="HamburgerMenu_menu__fxUil"></span></span></button></div></header><div class="relative z-40 w-full px-3 pt-3 sm:px-6 lg:px-8 sm:w-1/2 md:hidden hidden"><div class="mb-3"><strong class="block mb-1">Quick Start</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/chattycloud-workflow">ChattyCloud workflow</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/branching">Branching</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/connection-strings">Connection strings</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/database-imports">Database imports</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/regions">Regions</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/nonblocking-schema-changes">Non-blocking schema changes</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/web-console">Web console</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/authentication-methods">Authentication methods</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/mfa">Multi-factor authentication</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/sso">Single sign-on</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security">Security &amp; Compliance</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/access-control">Access control</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/audit-log">Audit log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security-log">Security log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/query-statistics">Query statistics</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/billing">Billing</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/back-up-and-restore">Back up and restore</a></span></div><div class="mb-3"><strong class="block mb-1">Tutorials</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/chattycloud-quick-start-guide">ChattyCloud quick start guide</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-any-application">Connect any app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-rails-app">Connect a Rails app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-nodejs-app">Connect a Node.js app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/nextjs-chattycloud-netlify-template">Next.js and Netlify Template</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/deploy-to-vercel">Deploy to Vercel</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/prisma-data-platform-integration">Prisma Data Platform integration</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/automatic-rails-migrations">Automatic Rails migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary bg-secondary !text-primary font-medium" href="/docs/tutorials/automatic-prisma-migrations">Automatic Prisma migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/change-unique-key">Change single unique key</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/operating-without-foreign-keys">Operating without FK constraints</a></span></div><div class="mb-3"><strong class="block mb-1">Reference</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-environment-setup">ChattyCloud environment set up</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-cli">ChattyCloud CLI</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/secure-connections">Secure connections</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/service-tokens">Service tokens</a></span></div><div class="flex items-stretch shadow-sm rounded text-primary inline-flex"><label class="flex items-center px-1.5 mb-0 font-medium border-t border-b border-l rounded-l bg-secondary border-secondary whitespace-nowrap text-sm py-1 h-button-sm">Theme</label><select class="inline-block pl-1.5 pr-4 py-0 border rounded shadow-sm bg-primary border-secondary focus-ring h-button-sm text-sm block w-full pl-2 rounded-l-none rounded-r !shadow-none"><option value="light">Light</option><option value="dark">Dark</option><option value="system">System</option></select></div></div></div><main class="flex flex-col flex-1 w-full px-3 py-4 mx-auto bg-primary md:py-8 max-w-7xl sm:px-6 lg:px-8"><div class="flex flex-col h-full md:flex-row"><div class="flex-shrink-0 hidden w-full md:block md:w-1/3 md:pr-4 lg:pr-8 xl:pr-12"><div class="mb-3"><strong class="block mb-1">Quick Start</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/chattycloud-workflow">ChattyCloud workflow</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/branching">Branching</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/connection-strings">Connection strings</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/database-imports">Database imports</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/regions">Regions</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/nonblocking-schema-changes">Non-blocking schema changes</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/web-console">Web console</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/authentication-methods">Authentication methods</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/mfa">Multi-factor authentication</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/sso">Single sign-on</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security">Security &amp; Compliance</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/access-control">Access control</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/audit-log">Audit log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security-log">Security log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/query-statistics">Query statistics</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/billing">Billing</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/back-up-and-restore">Back up and restore</a></span></div><div class="mb-3"><strong class="block mb-1">Tutorials</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/chattycloud-quick-start-guide">ChattyCloud quick start guide</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-any-application">Connect any app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-rails-app">Connect a Rails app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-nodejs-app">Connect a Node.js app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/nextjs-chattycloud-netlify-template">Next.js and Netlify Template</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/deploy-to-vercel">Deploy to Vercel</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/prisma-data-platform-integration">Prisma Data Platform integration</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/automatic-rails-migrations">Automatic Rails migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary bg-secondary !text-primary font-medium" href="/docs/tutorials/automatic-prisma-migrations">Automatic Prisma migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/change-unique-key">Change single unique key</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/operating-without-foreign-keys">Operating without FK constraints</a></span></div><div class="mb-3"><strong class="block mb-1">Reference</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-environment-setup">ChattyCloud environment set up</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-cli">ChattyCloud CLI</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/secure-connections">Secure connections</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/service-tokens">Service tokens</a></span></div><div class="flex items-stretch shadow-sm rounded text-primary inline-flex"><label class="flex items-center px-1.5 mb-0 font-medium border-t border-b border-l rounded-l bg-secondary border-secondary whitespace-nowrap text-sm py-1 h-button-sm">Theme</label><select class="inline-block pl-1.5 pr-4 py-0 border rounded shadow-sm bg-primary border-secondary focus-ring h-button-sm text-sm block w-full pl-2 rounded-l-none rounded-r !shadow-none"><option value="light">Light</option><option value="dark">Dark</option><option value="system">System</option></select></div></div><div class="relative flex-1 min-w-0"><div class="mdx-content"><div class="mb-4"><h1 class="mb-1 text-4xl font-semibold">Automatic Prisma migrations</h1><p class="text-xl text-secondary">To ensure PlanetScale works well with the Prisma development process, we implemented the ability to automatically copy Prisma migration metadata as part of our deployment process.</p></div><div><div class="my-4 border mb-3 px-3 py-2.5 rounded bg-purple-50 dark:bg-purple-900 border-purple-100 dark:border-purple-800"> <!-- --> <strong>Tip</strong><div class="mt-1 info-block">If you are using PlanetScale with Prisma, go to your database&#x27;s Settings page in the web app and enable &quot;Automatically copy migration data.&quot; Select &quot;Prisma&quot; as the migration framework. When enabled, this setting updates the<!-- --> <code>_prisma_migrations</code> table each time you branch with the latest migration. If disabled, running<!-- --> <code>prisma migrate dev</code> will try to run all migrations every time, instead of only the latest one.</div></div><a class="text-primary" href="#introduction"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="introduction">Introduction</h1></a><p>In this tutorial, we’re going to learn how to run automatic Prisma migrations in PlanetScale as part of our deployment process.</p><a class="text-primary" href="#quick-introduction-to-prisma-migrate"><h1 class="font-semibold text-lg mb-2 mt-3" as="h3" id="quick-introduction-to-prisma-migrate">Quick introduction to Prisma Migrate</h1></a><p>From a high level, <a href="https://www.prisma.io/docs/concepts/components/prisma-migrate">Prisma Migrate</a> is a imperative database schema migration tool that enables you to keep your database in sync with your Prisma schema as it evolves.</p><div class="my-4 border mb-3 px-3 py-2.5 rounded bg-purple-50 dark:bg-purple-900 border-purple-100 dark:border-purple-800"> <!-- --> <strong>Tip</strong><div class="mt-1 info-block">When you merge a deploy request in PlanetScale, the <code>_prisma_migrations</code> table in<!-- --> <code>main</code> gets automatically updated with the migrations from your branch.</div></div><a class="text-primary" href="#prerequisites-for-this-tutorial"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="prerequisites-for-this-tutorial">Prerequisites for this tutorial</h1></a><ul><li><code>git clone</code> this <a href="https://github.com/iheanyi/prisma-planetscale-playground">example project</a> and run <code>npm install</code>.</li><li>Install the <a href="https://github.com/planetscale/cli">PlanetScale CLI</a>.</li><li>Authenticate the CLI with the following command:</li></ul><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale auth login</span></div></div></div></div></pre><a class="text-primary" href="#execute-your-first-prisma-migration-on-planetscale"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="execute-your-first-prisma-migration-on-planetscale">Execute your first Prisma migration on PlanetScale</h1></a><p>Prisma migrations follow the PlanetScale <a href="/concepts/nonblocking-schema-changes">non-blocking schema change</a> workflow. First, the migration is applied to a <em>development</em> branch and then the development branch is merged into the <code>main</code> production database.</p><p>Let&#x27;s begin with an example flow for running Prisma migrations in PlanetScale:</p><ol><li>Create a new <em>prisma-playground</em> database:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale db create prisma-playground</span></div></div></div></div></pre><p>Make sure to go to your database&#x27;s Settings page to turn on &quot;Automatically copy migration data&quot; for Prisma after the database is created.</p><ol start="2"><li>Create a <code>shadow</code> database branch for Prisma from the default <code>main</code> branch:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale branch create prisma-playground shadow</span></div></div></div></div></pre><ol start="3"><li>Create an .env file:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain"># Environment variables declared in this file are automatically made available to Prisma.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain"># See the documentation for more detail: https://pris.ly/d/prisma-schema#using-environment-variables</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain"># Prisma supports the native connection string format for PostgreSQL, MySQL, SQLite, SQL Server (Preview) and MongoDB (Preview).</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain"># See the documentation for all the connection string options: https://pris.ly/d/connection-strings</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">DATABASE_URL=&quot;mysql://root@127.0.0.1:3309/prisma-playground&quot;</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">SHADOW_DATABASE_URL=&quot;mysql://root@127.0.0.1:3310/prisma-playground&quot;</span></div></div></div></div></pre><ol start="4"><li>Connect to the two branches:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale connect prisma-playground main --port 3309</span></div></div></div></div></pre><p>And in another terminal:</p><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale connect prisma-playground shadow --port 3310</span></div></div></div></div></pre><ol start="5"><li>In another terminal, use the <code>prisma migrate dev</code> command to generate and apply migrations from the schema defined in <code>prisma/schema.prisma</code>:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">npx prisma migrate dev --name init</span></div></div></div></div></pre><p>This Prisma command replays the existing migration history in the shadow database, applies pending migrations, generates a new migration from any changes you made, applies all unapplicated migrations to the main branch, and updates the <code>_prisma_migrations</code> table.</p><p>The <code>prisma migrate dev</code> command will create a SQL file like <code>prisma/migrations/20210806002614_init/migration.sql</code> (the exact folder will match the current timestamp and provided name).</p><div class="my-4 border mb-3 px-3 py-2.5 rounded bg-purple-50 dark:bg-purple-900 border-purple-100 dark:border-purple-800"> <!-- --> <strong>Tip</strong><div class="mt-1 info-block">You can learn more about the <code>prisma migrate dev</code> command in the<!-- --> <a href="https://www.prisma.io/docs/concepts/components/prisma-migrate#development-environments">Prisma docs</a>.</div></div><p>Along with the creating the new tables (User, Post, and Profile), Prisma has updated the <code>_prisma_migrations</code> table with status of your first migration.</p><ol start="6"><li>Now that the intial schema has been added, promote your <code>main</code> branch to production status:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale branch promote prisma-playground main</span></div></div></div></div></pre><a class="text-primary" href="#execute-succeeding-prisma-migrations-in-planetscale"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="execute-succeeding-prisma-migrations-in-planetscale">Execute succeeding Prisma migrations in PlanetScale</h1></a><p>Our first example migration flow went well, but what happens when you need to run further migrations?</p><p>Let’s take a look:</p><ol><li>Create a new <em>development</em> branch from <code>main</code>, <code>add-subtitle-to-posts</code>:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale branch create prisma-playground add-subtitle-to-posts</span></div></div></div></div></pre><p>As part of creating that branch, PlanetScale copies <em>every</em> row from <code>main</code>’s <code>_prisma_migrations</code> table over to your new development branch.</p><ol start="2"><li>Close the proxy connection to your <code>main</code> branch (if open) and connect to the new development and <code>shadow</code> branches:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale connect prisma-playground add-subtitle-to-posts --port 3309</span></div></div></div></div></pre><p>And in another terminal:</p><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale connect prisma-playground shadow --port 3310</span></div></div></div></div></pre><ol start="4"><li>In the <code>prisma/schema.prisma</code> file, update the <code>Post</code> model:</li></ol><p>Add a new <code>subtitle</code> field to <code>Post</code>:</p><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">subtitle  String   @db.VarChar(255)</span></div></div></div></div></pre><ol start="5"><li>Create a second Prisma migration for your table and call it <code>add-subtitle-to-posts</code>:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">npx prisma migrate dev --name add-subtitle-to-posts</span></div></div></div></div></pre><p>Prisma migrate checks <code>_prisma_migrations</code> to ensure your <code>create_users</code> migration already ran and proceeds to only run your new migration. In some cases, it might detect drift depending on your change.</p><ol start="6"><li>Open a deploy request for your <code>add-subtitle-to-posts</code> branch, so that you can deploy these changes to <code>main</code>.</li></ol><p>You can complete the deploy request either in the web app or with the <code>pscale deploy-request</code> command.</p><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale deploy-request create prisma-playground add-subtitle-to-posts</span></div></div></div></div></pre><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale deploy-request deploy prisma-playground 1</span></div></div></div></div></pre><ol start="7"><li>Once the deploy request is merged, you can see the results in your main branch&#x27;s <code>Post</code> and <code>_prisma_migrations</code> tabled:</li></ol><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">pscale shell prisma-playground main</span></div></div></div></div></pre><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">describe Post;</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">SELECT * from _prisma_migrations\G</span></div></div></div></div></pre><a class="text-primary" href="#what&#x27;s-next?"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="what&#x27;s-next?">What&#x27;s next?</h1></a><p>Now that you&#x27;ve successfully conducted your first automatic Prisma migration in PlanetScale and know how to handle future migrations, it&#x27;s time to deploy your application with a PlanetScale database! Let&#x27;s learn how to <a href="/tutorial/deploy-to-vercel">deploy an application with a PlanetScale database to Vercel</a>.</p><a class="text-primary" href="#need-help?"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="need-help?">Need help?</h1></a><p>Get help from <a href="https://www.planetscale.com/support">PlanetScale&#x27;s support team</a>, or join our <a href="https://github.com/planetscale/beta/discussions">GitHub Discussion board</a> to see how others are using PlanetScale.</p></div><div class="flex items-center mt-4 mb-4"><strong class="mr-1">Was this page useful?</strong><button type="button" class="mr-1 box-border relative inline-flex items-center justify-center text-center no-underline leading-none whitespace-nowrap font-semibold rounded flex-shrink-0 transition select-none overflow-hidden focus-ring text-primary hover:bg-secondary focus:border-blue-500 border border-gray-200 dark:border-gray-600 bg-primary text-sm py-sm px-1">Yes</button><button type="button" class="box-border relative inline-flex items-center justify-center text-center no-underline leading-none whitespace-nowrap font-semibold rounded flex-shrink-0 transition select-none overflow-hidden focus-ring text-primary hover:bg-secondary focus:border-blue-500 border border-gray-200 dark:border-gray-600 bg-primary text-sm py-sm px-1">No</button></div><div class="flex flex-col sm:flex-row sm:items-center justify-between pb-4 border-b mb-4"><div class="text-secondary mb-1 sm:mb-0">Last updated on <!-- -->December<!-- --> <!-- -->25<!-- -->, <!-- -->2021</div><a href="https://github.com/chattycloud/docs/blob/main/content/docs/tutorials/automatic-prisma-migrations.mdx">Help us improve this page</a></div></div><div class="mt-4 flex items-center justify-between"><span><a class="mr-1.5 text-secondary hover:text-blue" href="https://www.chatty-cloud.com/legal/privacy">Privacy</a><a class="text-secondary hover:text-blue" href="https://www.chatty-cloud.com/legal/siteterms">Terms</a></span><span class="text-secondary">© 2021 ChattyCloud Inc.</span></div></div></div></main></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Automatic Prisma migrations","subtitle":"To ensure PlanetScale works well with the Prisma development process, we implemented the ability to automatically copy Prisma migration metadata as part of our deployment process."},"headings":[{"depth":2,"value":"Introduction"},{"depth":3,"value":"Quick introduction to Prisma Migrate"},{"depth":2,"value":"Prerequisites for this tutorial"},{"depth":2,"value":"Execute your first Prisma migration on PlanetScale"},{"depth":2,"value":"Execute succeeding Prisma migrations in PlanetScale"},{"depth":2,"value":"What's next?"},{"depth":2,"value":"Need help?"}],"body":{"compiledSource":"var d=Object.defineProperty,c=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var p=(a,n,t)=\u003en in a?d(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=\u003e{for(var t in n||(n={}))r.call(n,t)\u0026\u0026p(a,t,n[t]);if(o)for(var t of o(n))l.call(n,t)\u0026\u0026p(a,t,n[t]);return a},s=(a,n)=\u003ec(a,h(n));var m=(a,n)=\u003e{var t={};for(var i in a)r.call(a,i)\u0026\u0026n.indexOf(i)\u003c0\u0026\u0026(t[i]=a[i]);if(a!=null\u0026\u0026o)for(var i of o(a))n.indexOf(i)\u003c0\u0026\u0026l.call(a,i)\u0026\u0026(t[i]=a[i]);return t};const makeShortcode=a=\u003efunction(t){return console.warn(\"Component \"+a+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",e({},t))},InfoBlock=makeShortcode(\"InfoBlock\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var i=t,{components:a}=i,n=m(i,[\"components\"]);return mdx(MDXLayout,s(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},`If you are using PlanetScale with Prisma, go to your database's Settings page in the web app and enable \"Automatically copy migration data.\" Select \"Prisma\" as the migration framework. When enabled, this setting updates the`,\" \",mdx(\"inlineCode\",null,\"_prisma_migrations\"),\" table each time you branch with the latest migration. If disabled, running\",\" \",mdx(\"inlineCode\",null,\"prisma migrate dev\"),\" will try to run all migrations every time, instead of only the latest one.\"),mdx(\"h2\",null,\"Introduction\"),mdx(\"p\",null,\"In this tutorial, we\\u2019re going to learn how to run automatic Prisma migrations in PlanetScale as part of our deployment process.\"),mdx(\"h3\",null,\"Quick introduction to Prisma Migrate\"),mdx(\"p\",null,\"From a high level, \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.prisma.io/docs/concepts/components/prisma-migrate\"}),\"Prisma Migrate\"),\" is a imperative database schema migration tool that enables you to keep your database in sync with your Prisma schema as it evolves.\"),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},\"When you merge a deploy request in PlanetScale, the \",mdx(\"inlineCode\",null,\"_prisma_migrations\"),\" table in\",\" \",mdx(\"inlineCode\",null,\"main\"),\" gets automatically updated with the migrations from your branch.\"),mdx(\"h2\",null,\"Prerequisites for this tutorial\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"git clone\"),\" this \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/iheanyi/prisma-planetscale-playground\"}),\"example project\"),\" and run \",mdx(\"inlineCode\",{parentName:\"li\"},\"npm install\"),\".\"),mdx(\"li\",{parentName:\"ul\"},\"Install the \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/planetscale/cli\"}),\"PlanetScale CLI\"),\".\"),mdx(\"li\",{parentName:\"ul\"},\"Authenticate the CLI with the following command:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale auth login\n`)),mdx(\"h2\",null,\"Execute your first Prisma migration on PlanetScale\"),mdx(\"p\",null,\"Prisma migrations follow the PlanetScale \",mdx(\"a\",e({parentName:\"p\"},{href:\"/concepts/nonblocking-schema-changes\"}),\"non-blocking schema change\"),\" workflow. First, the migration is applied to a \",mdx(\"em\",{parentName:\"p\"},\"development\"),\" branch and then the development branch is merged into the \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\" production database.\"),mdx(\"p\",null,\"Let's begin with an example flow for running Prisma migrations in PlanetScale:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Create a new \",mdx(\"em\",{parentName:\"li\"},\"prisma-playground\"),\" database:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale db create prisma-playground\n`)),mdx(\"p\",null,`Make sure to go to your database's Settings page to turn on \"Automatically copy migration data\" for Prisma after the database is created.`),mdx(\"ol\",e({},{start:2}),mdx(\"li\",{parentName:\"ol\"},\"Create a \",mdx(\"inlineCode\",{parentName:\"li\"},\"shadow\"),\" database branch for Prisma from the default \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\" branch:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale branch create prisma-playground shadow\n`)),mdx(\"ol\",e({},{start:3}),mdx(\"li\",{parentName:\"ol\"},\"Create an .env file:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`# Environment variables declared in this file are automatically made available to Prisma.\n# See the documentation for more detail: https://pris.ly/d/prisma-schema#using-environment-variables\n\n# Prisma supports the native connection string format for PostgreSQL, MySQL, SQLite, SQL Server (Preview) and MongoDB (Preview).\n# See the documentation for all the connection string options: https://pris.ly/d/connection-strings\n\nDATABASE_URL=\"mysql://root@127.0.0.1:3309/prisma-playground\"\nSHADOW_DATABASE_URL=\"mysql://root@127.0.0.1:3310/prisma-playground\"\n`)),mdx(\"ol\",e({},{start:4}),mdx(\"li\",{parentName:\"ol\"},\"Connect to the two branches:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale connect prisma-playground main --port 3309\n`)),mdx(\"p\",null,\"And in another terminal:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale connect prisma-playground shadow --port 3310\n`)),mdx(\"ol\",e({},{start:5}),mdx(\"li\",{parentName:\"ol\"},\"In another terminal, use the \",mdx(\"inlineCode\",{parentName:\"li\"},\"prisma migrate dev\"),\" command to generate and apply migrations from the schema defined in \",mdx(\"inlineCode\",{parentName:\"li\"},\"prisma/schema.prisma\"),\":\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`npx prisma migrate dev --name init\n`)),mdx(\"p\",null,\"This Prisma command replays the existing migration history in the shadow database, applies pending migrations, generates a new migration from any changes you made, applies all unapplicated migrations to the main branch, and updates the \",mdx(\"inlineCode\",{parentName:\"p\"},\"_prisma_migrations\"),\" table.\"),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"prisma migrate dev\"),\" command will create a SQL file like \",mdx(\"inlineCode\",{parentName:\"p\"},\"prisma/migrations/20210806002614_init/migration.sql\"),\" (the exact folder will match the current timestamp and provided name).\"),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},\"You can learn more about the \",mdx(\"inlineCode\",null,\"prisma migrate dev\"),\" command in the\",\" \",mdx(\"a\",{href:\"https://www.prisma.io/docs/concepts/components/prisma-migrate#development-environments\"},\"Prisma docs\"),\".\"),mdx(\"p\",null,\"Along with the creating the new tables (User, Post, and Profile), Prisma has updated the \",mdx(\"inlineCode\",{parentName:\"p\"},\"_prisma_migrations\"),\" table with status of your first migration.\"),mdx(\"ol\",e({},{start:6}),mdx(\"li\",{parentName:\"ol\"},\"Now that the intial schema has been added, promote your \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\" branch to production status:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale branch promote prisma-playground main\n`)),mdx(\"h2\",null,\"Execute succeeding Prisma migrations in PlanetScale\"),mdx(\"p\",null,\"Our first example migration flow went well, but what happens when you need to run further migrations?\"),mdx(\"p\",null,\"Let\\u2019s take a look:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Create a new \",mdx(\"em\",{parentName:\"li\"},\"development\"),\" branch from \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\", \",mdx(\"inlineCode\",{parentName:\"li\"},\"add-subtitle-to-posts\"),\":\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale branch create prisma-playground add-subtitle-to-posts\n`)),mdx(\"p\",null,\"As part of creating that branch, PlanetScale copies \",mdx(\"em\",{parentName:\"p\"},\"every\"),\" row from \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\"\\u2019s \",mdx(\"inlineCode\",{parentName:\"p\"},\"_prisma_migrations\"),\" table over to your new development branch.\"),mdx(\"ol\",e({},{start:2}),mdx(\"li\",{parentName:\"ol\"},\"Close the proxy connection to your \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\" branch (if open) and connect to the new development and \",mdx(\"inlineCode\",{parentName:\"li\"},\"shadow\"),\" branches:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale connect prisma-playground add-subtitle-to-posts --port 3309\n`)),mdx(\"p\",null,\"And in another terminal:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale connect prisma-playground shadow --port 3310\n`)),mdx(\"ol\",e({},{start:4}),mdx(\"li\",{parentName:\"ol\"},\"In the \",mdx(\"inlineCode\",{parentName:\"li\"},\"prisma/schema.prisma\"),\" file, update the \",mdx(\"inlineCode\",{parentName:\"li\"},\"Post\"),\" model:\")),mdx(\"p\",null,\"Add a new \",mdx(\"inlineCode\",{parentName:\"p\"},\"subtitle\"),\" field to \",mdx(\"inlineCode\",{parentName:\"p\"},\"Post\"),\":\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`subtitle  String   @db.VarChar(255)\n`)),mdx(\"ol\",e({},{start:5}),mdx(\"li\",{parentName:\"ol\"},\"Create a second Prisma migration for your table and call it \",mdx(\"inlineCode\",{parentName:\"li\"},\"add-subtitle-to-posts\"),\":\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`npx prisma migrate dev --name add-subtitle-to-posts\n`)),mdx(\"p\",null,\"Prisma migrate checks \",mdx(\"inlineCode\",{parentName:\"p\"},\"_prisma_migrations\"),\" to ensure your \",mdx(\"inlineCode\",{parentName:\"p\"},\"create_users\"),\" migration already ran and proceeds to only run your new migration. In some cases, it might detect drift depending on your change.\"),mdx(\"ol\",e({},{start:6}),mdx(\"li\",{parentName:\"ol\"},\"Open a deploy request for your \",mdx(\"inlineCode\",{parentName:\"li\"},\"add-subtitle-to-posts\"),\" branch, so that you can deploy these changes to \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\".\")),mdx(\"p\",null,\"You can complete the deploy request either in the web app or with the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pscale deploy-request\"),\" command.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale deploy-request create prisma-playground add-subtitle-to-posts\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale deploy-request deploy prisma-playground 1\n`)),mdx(\"ol\",e({},{start:7}),mdx(\"li\",{parentName:\"ol\"},\"Once the deploy request is merged, you can see the results in your main branch's \",mdx(\"inlineCode\",{parentName:\"li\"},\"Post\"),\" and \",mdx(\"inlineCode\",{parentName:\"li\"},\"_prisma_migrations\"),\" tabled:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale shell prisma-playground main\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-SQL\"}),`describe Post;\n\nSELECT * from _prisma_migrations\\\\G\n`)),mdx(\"h2\",null,\"What's next?\"),mdx(\"p\",null,\"Now that you've successfully conducted your first automatic Prisma migration in PlanetScale and know how to handle future migrations, it's time to deploy your application with a PlanetScale database! Let's learn how to \",mdx(\"a\",e({parentName:\"p\"},{href:\"/tutorial/deploy-to-vercel\"}),\"deploy an application with a PlanetScale database to Vercel\"),\".\"),mdx(\"h2\",null,\"Need help?\"),mdx(\"p\",null,\"Get help from \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.planetscale.com/support\"}),\"PlanetScale's support team\"),\", or join our \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/planetscale/beta/discussions\"}),\"GitHub Discussion board\"),\" to see how others are using PlanetScale.\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"fields":{"slug":"tutorials/automatic-prisma-migrations","lastUpdatedOn":"2021-12-25T04:33:56.251Z"}},"__N_SSG":true},"page":"/[category]/[post]","query":{"category":"tutorials","post":"automatic-prisma-migrations"},"buildId":"ffRgkaqinJ87gnfSh8k4z","assetPrefix":"/docs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>