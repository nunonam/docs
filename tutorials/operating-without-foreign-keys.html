<!DOCTYPE html><html lang="en"><head><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="#262626" name="theme-color"/><link rel="mask-icon" href="/favicon.svg" color="#262626"/><script>!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="gURNntij37hKxpSUjda9znzNaOxZBG6H";;analytics.SNIPPET_VERSION="4.15.3";
analytics.load("gURNntij37hKxpSUjda9znzNaOxZBG6H");
analytics.page();
}}();</script><link rel="preload" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" as="style"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement;d.classList.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';d.classList.add('dark')}else{d.style.colorScheme = 'light';d.classList.add('light')}}else if(e){d.classList.add(e|| '')}else{d.classList.add('dark')}if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'dark'}catch(e){}}()</script><link rel="shortcut icon" href="/favicon_system.svg" sizes="any" type="image/svg+xml"/><title>Operating without foreign key constraints - Documentation - ChattyCloud</title><meta name="msapplication-TileColor" content="#da532c"/><meta name="description" content="How to manage your relational data without formal foreign key constraints in your schema"/><meta property="og:url" content="https://docs.chatty-cloud.com/tutorials/operating-without-foreign-keys"/><meta property="og:image" content="https://docs.chatty-cloud.com//img/internals/social_share.png"/><meta property="og:type" content="website"/><meta property="og:title" content="Operating without foreign key constraints - Documentation - ChattyCloud"/><meta property="og:description" content="How to manage your relational data without formal foreign key constraints in your schema"/><meta name="twitter:url" content="https://docs.chatty-cloud.com/tutorials/operating-without-foreign-keys"/><meta name="twitter:image" content="https://docs.chatty-cloud.com//img/internals/social_share.png"/><meta name="twitter:title" content="Operating without foreign key constraints - Documentation - ChattyCloud"/><meta name="twitter:description" content="How to manage your relational data without formal foreign key constraints in your schema"/><script type="application/ld+json">{&quot;@context&quot;:&quot;http://schema.org&quot;,&quot;@type&quot;:&quot;Organization&quot;,&quot;name&quot;:&quot;ChattyCloud, Inc.&quot;,&quot;url&quot;:&quot;https://docs.chatty-cloud.com&quot;,&quot;sameAs&quot;:[&quot;https://twitter.com/&quot;],&quot;address&quot;:{&quot;@type&quot;:&quot;PostalAddress&quot;,&quot;streetAddress&quot;:&quot;321 Castro St #200&quot;,&quot;addressLocality&quot;:&quot;Mountain View&quot;,&quot;addressRegion&quot;:&quot;CA&quot;,&quot;postalCode&quot;:&quot;94041&quot;,&quot;addressCountry&quot;:&quot;US&quot;}}</script><meta name="next-head-count" content="18"/><link rel="preload" href="/docs/_next/static/css/d19452855f080e47.css" as="style"/><link rel="stylesheet" href="/docs/_next/static/css/d19452855f080e47.css" data-n-g=""/><link rel="preload" href="/docs/_next/static/css/6ed6fc696efb435c.css" as="style"/><link rel="stylesheet" href="/docs/_next/static/css/6ed6fc696efb435c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/docs/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/docs/_next/static/chunks/webpack-21775410f7f02689.js" defer=""></script><script src="/docs/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/docs/_next/static/chunks/main-d78ee85becc0fade.js" defer=""></script><script src="/docs/_next/static/chunks/pages/_app-4f84c90584aacdb0.js" defer=""></script><script src="/docs/_next/static/chunks/217-13521f692b432699.js" defer=""></script><script src="/docs/_next/static/chunks/228-546d180dcfb89379.js" defer=""></script><script src="/docs/_next/static/chunks/476-5e8e8e79956619f9.js" defer=""></script><script src="/docs/_next/static/chunks/pages/%5Bcategory%5D/%5Bpost%5D-0dfa5a716bfbcb43.js" defer=""></script><script src="/docs/_next/static/-s0dJXBYWF7LmYhpsQySm/_buildManifest.js" defer=""></script><script src="/docs/_next/static/-s0dJXBYWF7LmYhpsQySm/_ssgManifest.js" defer=""></script><script src="/docs/_next/static/-s0dJXBYWF7LmYhpsQySm/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="h-full"><div class="flex flex-col mx-auto bg-primary text-primary"><a href="#content" class="absolute z-50 px-2 py-1 border-b border-r rounded-br -ml-96 focus:ml-0 bg-secondary">Skip to content</a><div class="relative z-40 w-full py-3 mx-auto border-b bg-primary text-primary"><div class="md:hidden duration-300 fixed z-30 inset-0 transition-opacity opacity-0 pointer-events-none" aria-hidden="true"><div class="absolute inset-0 bg-primary"></div></div><header class="relative z-50 grid items-center grid-cols-2 px-3 mx-auto md:grid-cols-3 md:grid-rows-1 max-w-7xl sm:px-6 lg:px-8"><div class="flex items-center col-start-1 row-start-1"><a class="rounded text-primary" aria-label="Go to documentation homepage" href="https://chatty-cloud.com"><svg width="41" height="32" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 41 32"><path fill="currentColor" d="M39.386 0l-7.238 7.403C29.378 3.05 24.594.18 19.177.18c-4.13 0-8.014 1.672-10.918 4.721-2.892 3.029-4.487 7.046-4.487 11.316 0 1.093.102 2.166.317 3.207a28.011 28.011 0 00-2.31 2.745c-1.85 2.566-2.26 4.49-1.217 5.71.154.189.634.694 1.564.778.082.01.154.01.235.01 1.493 0 3.343-1.125 5.48-3.354l16.978-17.32-1.186-1.23L7.38 23.345a13.864 13.864 0 01-1.932-7.119c0-3.817 1.421-7.403 4.007-10.106 2.587-2.713 6.042-4.206 9.722-4.206 4.957 0 9.312 2.692 11.745 6.73l-12.92 13.219c-.84.862-1.892 1.924-2.659 3.112-1.39 2.135-1.083 3.723-.777 4.47l.01.02c.358.831.972 1.494 1.78 1.936.92.494 1.85.567 2.79.599h.04a15.249 15.249 0 0010.959-4.637c2.934-2.987 4.549-6.983 4.549-11.232a16.2 16.2 0 00-1.666-7.182L40.57 1.23 39.386 0zM2.36 26.942h-.01c-.286 0-.43-.105-.47-.137l-.041-.052c-.327-.379-.164-1.504 1.288-3.534.49-.694 1.043-1.335 1.492-1.85.389 1.114.9 2.187 1.534 3.217-2.065 2.03-3.251 2.356-3.793 2.356zm26.598-.8c-2.596 2.65-6.072 4.123-9.762 4.133-.93-.031-1.503-.105-2.055-.41a2.277 2.277 0 01-1.022-1.093c-.409-1.052.307-2.335.634-2.84.675-1.04 1.656-2.04 2.443-2.839l12.573-12.85a14.529 14.529 0 011.247 5.899c-.02 3.786-1.451 7.34-4.058 10z"></path></svg></a><div class="flex items-center lg:text-lg font-medium pl-1.5"><a class="text-primary" href="/docs">Documentation</a></div></div><div class="col-start-1 col-span-2 md:col-span-1 pt-3 md:pt-0 row-start-3 md:col-start-2 md:row-start-1 md:flex hidden"><input type="search" class="w-full leading-[1.5rem] px-1.5 rounded ring-offset-0 border shadow-sm text-base py-sm focus-ring bg-secondary text-primary border-secondary" id="searchbox" placeholder="Search documentation"/></div><div class="col-start-1 col-span-2 md:col-span-1 row-start-2 pt-5 md:pt-0 md:row-start-1 md:col-start-3 md:justify-end md:flex hidden"><a href="https://dashboard.chatty-cloud.com" class="mr-2 box-border relative inline-flex items-center justify-center text-center no-underline leading-none whitespace-nowrap font-semibold rounded flex-shrink-0 transition select-none overflow-hidden focus-ring text-primary hover:bg-secondary focus:border-blue-500 border border-gray-200 dark:border-gray-600 bg-primary h-button py-1.5 px-2">dashboard</a></div><div class="relative z-50 flex justify-end col-start-2 row-start-1 align-center md:hidden"><button aria-label="Open navigation menu" class="flex appearance-none focus:outline-none"><span class="HamburgerMenu_menuWrapper__TCSWe" data-open="false"><span class="HamburgerMenu_menu__fxUil"></span></span></button></div></header><div class="relative z-40 w-full px-3 pt-3 sm:px-6 lg:px-8 sm:w-1/2 md:hidden hidden"><div class="mb-3"><strong class="block mb-1">Quick Start</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/chattycloud-workflow">ChattyCloud workflow</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/branching">Branching</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/connection-strings">Connection strings</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/database-imports">Database imports</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/regions">Regions</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/nonblocking-schema-changes">Non-blocking schema changes</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/web-console">Web console</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/authentication-methods">Authentication methods</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/mfa">Multi-factor authentication</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/sso">Single sign-on</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security">Security &amp; Compliance</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/access-control">Access control</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/audit-log">Audit log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security-log">Security log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/query-statistics">Query statistics</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/billing">Billing</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/back-up-and-restore">Back up and restore</a></span></div><div class="mb-3"><strong class="block mb-1">Tutorials</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/chattycloud-quick-start-guide">ChattyCloud quick start guide</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-any-application">Connect any app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-rails-app">Connect a Rails app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-nodejs-app">Connect a Node.js app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/nextjs-chattycloud-netlify-template">Next.js and Netlify Template</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/deploy-to-vercel">Deploy to Vercel</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/prisma-data-platform-integration">Prisma Data Platform integration</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/automatic-rails-migrations">Automatic Rails migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/automatic-prisma-migrations">Automatic Prisma migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/change-unique-key">Change single unique key</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary bg-secondary !text-primary font-medium" href="/docs/tutorials/operating-without-foreign-keys">Operating without FK constraints</a></span></div><div class="mb-3"><strong class="block mb-1">Reference</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-environment-setup">ChattyCloud environment set up</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-cli">ChattyCloud CLI</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/secure-connections">Secure connections</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/service-tokens">Service tokens</a></span></div><div class="flex items-stretch shadow-sm rounded text-primary inline-flex"><label class="flex items-center px-1.5 mb-0 font-medium border-t border-b border-l rounded-l bg-secondary border-secondary whitespace-nowrap text-sm py-1 h-button-sm">Theme</label><select class="inline-block pl-1.5 pr-4 py-0 border rounded shadow-sm bg-primary border-secondary focus-ring h-button-sm text-sm block w-full pl-2 rounded-l-none rounded-r !shadow-none"><option value="light">Light</option><option value="dark">Dark</option><option value="system">System</option></select></div></div></div><main class="flex flex-col flex-1 w-full px-3 py-4 mx-auto bg-primary md:py-8 max-w-7xl sm:px-6 lg:px-8"><div class="flex flex-col h-full md:flex-row"><div class="flex-shrink-0 hidden w-full md:block md:w-1/3 md:pr-4 lg:pr-8 xl:pr-12"><div class="mb-3"><strong class="block mb-1">Quick Start</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/chattycloud-workflow">ChattyCloud workflow</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/branching">Branching</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/connection-strings">Connection strings</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/database-imports">Database imports</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/regions">Regions</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/nonblocking-schema-changes">Non-blocking schema changes</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/web-console">Web console</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/authentication-methods">Authentication methods</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/mfa">Multi-factor authentication</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/sso">Single sign-on</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security">Security &amp; Compliance</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/access-control">Access control</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/audit-log">Audit log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/security-log">Security log</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/query-statistics">Query statistics</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/billing">Billing</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/concepts/back-up-and-restore">Back up and restore</a></span></div><div class="mb-3"><strong class="block mb-1">Tutorials</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/chattycloud-quick-start-guide">ChattyCloud quick start guide</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-any-application">Connect any app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-rails-app">Connect a Rails app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/connect-nodejs-app">Connect a Node.js app</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/nextjs-chattycloud-netlify-template">Next.js and Netlify Template</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/deploy-to-vercel">Deploy to Vercel</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/prisma-data-platform-integration">Prisma Data Platform integration</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/automatic-rails-migrations">Automatic Rails migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/automatic-prisma-migrations">Automatic Prisma migrations</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/tutorials/change-unique-key">Change single unique key</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary bg-secondary !text-primary font-medium" href="/docs/tutorials/operating-without-foreign-keys">Operating without FK constraints</a></span></div><div class="mb-3"><strong class="block mb-1">Reference</strong><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-environment-setup">ChattyCloud environment set up</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/chattycloud-cli">ChattyCloud CLI</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/secure-connections">Secure connections</a></span><span class="block -ml-1.5"><a class="px-1.5 rounded-sm block leading-loose py-0.5 text-secondary hover:text-primary hover:bg-secondary" href="/docs/reference/service-tokens">Service tokens</a></span></div><div class="flex items-stretch shadow-sm rounded text-primary inline-flex"><label class="flex items-center px-1.5 mb-0 font-medium border-t border-b border-l rounded-l bg-secondary border-secondary whitespace-nowrap text-sm py-1 h-button-sm">Theme</label><select class="inline-block pl-1.5 pr-4 py-0 border rounded shadow-sm bg-primary border-secondary focus-ring h-button-sm text-sm block w-full pl-2 rounded-l-none rounded-r !shadow-none"><option value="light">Light</option><option value="dark">Dark</option><option value="system">System</option></select></div></div><div class="relative flex-1 min-w-0"><div class="mdx-content"><div class="mb-4"><h1 class="mb-1 text-4xl font-semibold">Operating without foreign key constraints</h1><p class="text-xl text-secondary">How to manage your relational data without formal foreign key constraints in your schema</p></div><div><a class="text-primary" href="#overview"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="overview">Overview</h1></a><p>A foreign key is a logical association of rows between two tables, in a parent-child relationship. A row in a &quot;parent&quot; table may be referenced by one or more rows in a &quot;child&quot; table. A foreign key typically suggests how you should <code>JOIN</code> tables in most queries. It is possible for a table to refer onto itself, as a special case.</p><p>A <code>FOREIGN KEY</code> <em>constraint</em> is a database construct, an implementation that <em>forces</em> the foreign key relationship&#x27;s integrity (aka referential integrity). Namely, it ensures that a child table can only reference a parent table when the appropriate row <em>exists</em> in the parent table. A constraint prevents the existence of such &quot;orphaned rows&quot; in different methods, described below.</p><p>PlanetScale doesn&#x27;t support <code>FOREIGN KEY</code> constraints. You are encouraged to use the relational model, and associate tables by &quot;pointing&quot; rows from one table to another. However, the <code>CONSTRAINT ... FOREIGN KEY</code> definition is not allowed in your schemas.</p><p>There are two major technical reasons why foreign key constraints are not supported:</p><ol><li>The way <code>FOREIGN KEY</code> constraints are implemented in MySQL (or, rather, in the InnoDB storage engine) interferes with Online DDL operations. Learn more in <a href="https://vitess.io/blog/2021-06-15-online-ddl-why-no-fk/">this Vitess blog post</a>.</li><li>Limited to single MySQL server scope, <code>FOREIGN KEY</code> constraints are impossible to maintain once your data grows and is split over multiple database servers. This typically happens when you introduce functional partitioning/sharding and/or horizontal sharding.</li></ol><p>We believe the advantages of Online DDL: branching, developer owned schema changes and deployments, <a href="/concepts/nonblocking-schema-changes">non-blocking schema changes</a> etc., and the advantages of sharding as means of unlimited scaling, outweigh the <code>FOREIGN KEY</code> constraints benefits.</p><div class="my-4 border mb-3 px-3 py-2.5 rounded bg-blue-50 dark:bg-blue-900 border-blue-100 dark:border-blue-800"><strong>Note</strong> <!-- --> <div class="mt-1 info-block">You can still think in terms of foreign key relationships; of parent tables and child tables; of rows referencing each other. You can structure your tables in the exact same way without FOREIGN KEY constraints as you would with the constraints.</div></div> <p>To understand how to work without foreign key constraints, we must first understand foreign key functionality.</p><a class="text-primary" href="#types-and-behavior-of-foreign-key-constraints"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="types-and-behavior-of-foreign-key-constraints">Types and behavior of FOREIGN KEY constraints</h1></a><p>Consider the following trivial parent-child table relationship:</p><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">CREATE TABLE parent_table (</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  id INT NOT NULL,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  PRIMARY KEY (id)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">);</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">CREATE TABLE child_table (</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  id INT NOT NULL,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  parent_id INT,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  PRIMARY KEY (id),</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  KEY parent_id_idx (parent_id),</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  CONSTRAINT `child_parent_fk` FOREIGN KEY (parent_id) REFERENCES parent_table(id) ON DELETE NO ACTION</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">);</span></div></div></div></div></pre><div class="my-4 border mb-3 px-3 py-2.5 rounded bg-purple-50 dark:bg-purple-900 border-purple-100 dark:border-purple-800"> <!-- --> <strong>Tip</strong><div class="mt-1 info-block">In MySQL, foreign keys are only implemented by the storage engine layer, namely the default and popular InnoDB engine. A FOREIGN KEY constraint isn&#x27;t a separate entity. It lives within the child&#x27;s table space.</div></div> <p><code>FOREIGN KEY</code> constraints are available for row deletion (<code>ON DELETE</code>) and row updates (<code>ON UPDATE</code>). In this document we discuss <code>ON DELETE</code> as it is the more impactful of the two. The discussion is relevant to <code>ON UPDATE</code> constraints, as well.</p><p>Foreign keys further support three types of action (illustrated below for <code>ON DELETE</code>):</p><a class="text-primary" href="#"><h1 class="font-semibold text-lg mb-2 mt-3" as="h3" id=""><code>ON DELETE CASCADE</code></h1></a><p>This is the most greedy, or ambitious action type. If you <code>DELETE</code> a row from a parent table, any referencing rows in a child table are subsequently deleted within the same transaction. This operation runs recursively for all of a parent&#x27;s children, as well as for their children, should they also employ <code>ON DELETE CASCADE</code>.</p><p><code>ON DELETE CASCADE</code> is a risky and resource consuming action. You intend to <code>DELETE</code> a single row, but end up deleting hundreds, thousands, or more, rows in multiple tables. What seemed like a simple transaction now turns into a massive operation, that involves excessive locking, increased MVCC overhead, impact on replication lag, and more.</p><p>But perhaps the greatest danger is the potential unexpected loss of data. Whether an unsuspecting developer simply assumes a <code>DELETE FROM parent_table WHERE id=3</code> will at most delete one row, down to surprising behavior such as in <code>REPLACE INTO</code> queries, which actually run an implicit <code>DELETE</code>, leading to mass destruction of data.</p><p>The use of <code>ON DELETE CASCADE</code> is controversial. Use it with great care. Consider using <code>NO ACTION</code> instead.</p><a class="text-primary" href="#"><h1 class="font-semibold text-lg mb-2 mt-3" as="h3" id=""><code>ON DELETE SET NULL</code></h1></a><p>With this setup, a <code>DELETE</code> on a parent (e.g. <code>DELETE FROM parent_table WHERE id=3</code>) will set the referencing column on children (e.g. <code>parent_id</code> column in <code>child_table</code>) to <code>NULL</code> for matching rows. It effectively leads to orphaned rows, not very differently from having no foreign key constraints at all.</p><p>One advantage is that it&#x27;s easy to identify the orphan rows: those, and only those rows, will have <code>NULL</code> for parent-referencing columns.</p><p>Like <code>CASCADE</code>, a single row deletion on the parent may lead to multiple rows updated on child tables. This again may cause large transactions, excessive locking, and replication lag.</p><a class="text-primary" href="#"><h1 class="font-semibold text-lg mb-2 mt-3" as="h3" id=""><code>ON DELETE NO ACTION</code></h1></a><p>Possibly the single most important feature of foreign keys, a <code>DELETE</code> on a parent will fail if child rows exist that reference the parent&#x27;s row. To <code>DELETE</code> a row from a parent, the app/user must first <code>DELETE</code> the referencing rows from all children. Recursively, if those are further referenced by other tables, the app/user must first <code>DELETE</code> rows from grandchildren, and so forth.</p><p>This action (or lack thereof) type forces the app to have stronger ownership of its data. An app written to work with <code>ON DELETE NO ACTION</code> will organically evolve <em>knowing</em> which tables reference which other tables, and will have established <code>DELETE</code>/<code>UPDATE</code> flows that iterate through tables in the correct order so as to satisfy referential integrity.</p><a class="text-primary" href="#how-does-your-schema-look-without-foreign-key-constraints?"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="how-does-your-schema-look-without-foreign-key-constraints?">How does your schema look without FOREIGN KEY constraints?</h1></a><p>The above schema would look exactly the same, minus the <code>CONSTRAINT</code> clause:</p><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">CREATE TABLE parent_table (</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  id INT NOT NULL,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  PRIMARY KEY (id)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">);</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">CREATE TABLE child_table (</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  id INT NOT NULL,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  parent_id INT,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  PRIMARY KEY (id),</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">  KEY parent_id_idx (parent_id)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">);</span></div></div></div></div></pre><div class="my-4 border mb-3 px-3 py-2.5 rounded bg-purple-50 dark:bg-purple-900 border-purple-100 dark:border-purple-800"> <!-- --> <strong>Tip</strong><div class="mt-1 info-block">Each FOREIGN KEY constraint requires an index covering the referenced column(s) on both sides of the connection. The index parent_id_idx is <i>required</i> by the constraint. We can drop that key in our constraint-free table, depending on the type of queries we might use to retrieve data from the tables.</div></div> <a class="text-primary" href="#developing-an-app-with-no-foreign-key-constraints"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="developing-an-app-with-no-foreign-key-constraints">Developing an app with no FOREIGN KEY constraints</h1></a><p>Consider an app&#x27;s behavior in a <code>ON DELETE NO ACTION</code> setup again: the app <em>knows</em> the tables dependencies, handles iteration order for <code>DELETE</code>/<code>UPDATE</code>. It does everything right.</p><p>What happens if we take away the <code>CONSTRAINT</code> at this point?</p><p>The app remains unchanged. It already runs the proper actions in the proper order. The app operation that ends up running the <code>DELETE FROM parent_table WHERE id=3</code> succeeds the app operations that <code>DELETE</code> the child table(s). While we lose the database&#x27;s safety guarantee enforcing this behavior, we are perfectly capable of managing it on our own.</p><p>Likewise, an app that grows with a constraint-less schema, organically learns to handle <code>DELETE</code> and <code>UPDATE</code> scenarios. It is in fact given some extra freedom, because the <em>order</em> of operations is not enforced. This is an advantage, because the app is not forced to <code>DELETE</code> thousands of dependent rows for each parent row deletion <em>at that same transaction</em>. The app may well postpone deletion as we discuss shortly.</p><p>Referential integrity is but one of many logical data integrity constraints, it just happens to be one that databases are able to enforce. Any sizeable application will maintain the integrity of its data with rules the database is unaware of.</p><a class="text-primary" href="#cleaning-up-orphaned-rows"><h1 class="font-semibold text-xl mb-2 mt-3" as="h2" id="cleaning-up-orphaned-rows">Cleaning up orphaned rows</h1></a><p>Consider an <code>ON DELETE SET NULL</code> constraint. What happens to the child rows that were set to <code>NULL</code>? Typically, there is little or no damage in keeping them around. A query can, for example, <code>SELECT</code> rows <code>WHERE parent_id IS NOT NULL</code>. Better yet, child rows are often <code>JOIN</code>ed with their respective parent rows. Any query running such a <code>JOIN</code> will return empty, since the parent row does not exist.</p><p>Eventually, those rows will pile up, and you will want to reclaim the space.</p><p>Without <code>FOREIGN KEY</code> constraints, the situation is very much the same, It is possible to <code>DELETE</code> a parent row without deleting its dependant children rows. A child row <code>JOIN</code>ed with a respective (deleted) parent row comes out empty. There is no <code>IS NOT NULL</code> to help you, but identifying those rows is still trivial. Similarly, there is little or no damage in keeping those rows around for a while.</p><p>And similarly, those rows eventually pile up.</p><p>A common practice, where appropriate, is to <code>DELETE</code> rows on a parent table, or perhaps also on a subset of children, but leave some other tables for offline batch processing.</p><p>At some convenient time, such as low traffic hours, the app or some batch job will purge orphaned rows. Consider this simplified query:</p><pre><div class="max-w-full mt-2 mb-4 border rounded"><div class="flex items-center justify-between px-2 border-b rounded-t py-sm bg-secondary"><span class="font-sans text-secondary"></span><div class="relative inline-flex"><button aria-label="Copy snippet" title="Copy snippet" type="button" class="undefined h-[32px] h-button px-1 focus-visible-ring"></button><div class="font-sans pointer-events-none transition absolute z-10 px-1 text-white font-semibold dark:bg-gray-50 dark:text-gray-900 text-sm transform -translate-x-1/2 bg-gray-900 rounded shadow-lg py-sm left-1/2 top-1/2 opacity-0">Copied</div></div></div><div class="w-full p-2 overflow-x-auto"><div><div class="token-line" style="color:#9a86fd"><span class="token plain">DELETE FROM child_table LEFT JOIN parent_table ON (child_table.parent_id=parent_table.id) WHERE parent_table.id IS NULL</span></div></div></div></div></pre><p>A single <code>DELETE</code> is likely a massive operation, which is to be avoided. A good practice is to break the statement into multiple small-scope statements, e.g. deleting <code>100</code> rows at a time.</p></div><div class="flex items-center mt-4 mb-4"><strong class="mr-1">Was this page useful?</strong><button type="button" class="mr-1 box-border relative inline-flex items-center justify-center text-center no-underline leading-none whitespace-nowrap font-semibold rounded flex-shrink-0 transition select-none overflow-hidden focus-ring text-primary hover:bg-secondary focus:border-blue-500 border border-gray-200 dark:border-gray-600 bg-primary text-sm py-sm px-1">Yes</button><button type="button" class="box-border relative inline-flex items-center justify-center text-center no-underline leading-none whitespace-nowrap font-semibold rounded flex-shrink-0 transition select-none overflow-hidden focus-ring text-primary hover:bg-secondary focus:border-blue-500 border border-gray-200 dark:border-gray-600 bg-primary text-sm py-sm px-1">No</button></div><div class="flex flex-col sm:flex-row sm:items-center justify-between pb-4 border-b mb-4"><div class="text-secondary mb-1 sm:mb-0">Last updated on <!-- -->December<!-- --> <!-- -->25<!-- -->, <!-- -->2021</div><a href="https://github.com/chattycloud/docs/blob/main/content/docs/tutorials/operating-without-foreign-keys.mdx">Help us improve this page</a></div></div><div class="mt-4 flex items-center justify-between"><span><a class="mr-1.5 text-secondary hover:text-blue" href="https://www.chatty-cloud.com/legal/privacy">Privacy</a><a class="text-secondary hover:text-blue" href="https://www.chatty-cloud.com/legal/siteterms">Terms</a></span><span class="text-secondary">© 2021 ChattyCloud Inc.</span></div></div></div></main></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Operating without foreign key constraints","subtitle":"How to manage your relational data without formal foreign key constraints in your schema"},"headings":[{"depth":2,"value":"Overview"},{"depth":2,"value":"Types and behavior of FOREIGN KEY constraints"},{"depth":3,"value":"`ON DELETE CASCADE`"},{"depth":3,"value":"`ON DELETE SET NULL`"},{"depth":3,"value":"`ON DELETE NO ACTION`"},{"depth":2,"value":"How does your schema look without FOREIGN KEY constraints?"},{"depth":2,"value":"Developing an app with no FOREIGN KEY constraints"},{"depth":2,"value":"Cleaning up orphaned rows"}],"body":{"compiledSource":"var h=Object.defineProperty,c=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var l=(e,n,i)=\u003en in e?h(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,a=(e,n)=\u003e{for(var i in n||(n={}))r.call(n,i)\u0026\u0026l(e,i,n[i]);if(o)for(var i of o(n))s.call(n,i)\u0026\u0026l(e,i,n[i]);return e},p=(e,n)=\u003ec(e,m(n));var d=(e,n)=\u003e{var i={};for(var t in e)r.call(e,t)\u0026\u0026n.indexOf(t)\u003c0\u0026\u0026(i[t]=e[t]);if(e!=null\u0026\u0026o)for(var t of o(e))n.indexOf(t)\u003c0\u0026\u0026s.call(e,t)\u0026\u0026(i[t]=e[t]);return i};const makeShortcode=e=\u003efunction(i){return console.warn(\"Component \"+e+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",a({},i))},InfoBlock=makeShortcode(\"InfoBlock\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(i){var t=i,{components:e}=t,n=d(t,[\"components\"]);return mdx(MDXLayout,p(a(a({},layoutProps),n),{components:e,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"Overview\"),mdx(\"p\",null,'A foreign key is a logical association of rows between two tables, in a parent-child relationship. A row in a \"parent\" table may be referenced by one or more rows in a \"child\" table. A foreign key typically suggests how you should ',mdx(\"inlineCode\",{parentName:\"p\"},\"JOIN\"),\" tables in most queries. It is possible for a table to refer onto itself, as a special case.\"),mdx(\"p\",null,\"A \",mdx(\"inlineCode\",{parentName:\"p\"},\"FOREIGN KEY\"),\" \",mdx(\"em\",{parentName:\"p\"},\"constraint\"),\" is a database construct, an implementation that \",mdx(\"em\",{parentName:\"p\"},\"forces\"),\" the foreign key relationship's integrity (aka referential integrity). Namely, it ensures that a child table can only reference a parent table when the appropriate row \",mdx(\"em\",{parentName:\"p\"},\"exists\"),' in the parent table. A constraint prevents the existence of such \"orphaned rows\" in different methods, described below.'),mdx(\"p\",null,\"PlanetScale doesn't support \",mdx(\"inlineCode\",{parentName:\"p\"},\"FOREIGN KEY\"),' constraints. You are encouraged to use the relational model, and associate tables by \"pointing\" rows from one table to another. However, the ',mdx(\"inlineCode\",{parentName:\"p\"},\"CONSTRAINT ... FOREIGN KEY\"),\" definition is not allowed in your schemas.\"),mdx(\"p\",null,\"There are two major technical reasons why foreign key constraints are not supported:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"The way \",mdx(\"inlineCode\",{parentName:\"li\"},\"FOREIGN KEY\"),\" constraints are implemented in MySQL (or, rather, in the InnoDB storage engine) interferes with Online DDL operations. Learn more in \",mdx(\"a\",a({parentName:\"li\"},{href:\"https://vitess.io/blog/2021-06-15-online-ddl-why-no-fk/\"}),\"this Vitess blog post\"),\".\"),mdx(\"li\",{parentName:\"ol\"},\"Limited to single MySQL server scope, \",mdx(\"inlineCode\",{parentName:\"li\"},\"FOREIGN KEY\"),\" constraints are impossible to maintain once your data grows and is split over multiple database servers. This typically happens when you introduce functional partitioning/sharding and/or horizontal sharding.\")),mdx(\"p\",null,\"We believe the advantages of Online DDL: branching, developer owned schema changes and deployments, \",mdx(\"a\",a({parentName:\"p\"},{href:\"/concepts/nonblocking-schema-changes\"}),\"non-blocking schema changes\"),\" etc., and the advantages of sharding as means of unlimited scaling, outweigh the \",mdx(\"inlineCode\",{parentName:\"p\"},\"FOREIGN KEY\"),\" constraints benefits.\"),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"You can still think in terms of foreign key relationships; of parent tables and child tables; of rows referencing each other. You can structure your tables in the exact same way without FOREIGN KEY constraints as you would with the constraints.\"),\" \",mdx(\"p\",null,\"To understand how to work without foreign key constraints, we must first understand foreign key functionality.\"),mdx(\"h2\",null,\"Types and behavior of FOREIGN KEY constraints\"),mdx(\"p\",null,\"Consider the following trivial parent-child table relationship:\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-sql\"}),`CREATE TABLE parent_table (\n  id INT NOT NULL,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE child_table (\n  id INT NOT NULL,\n  parent_id INT,\n  PRIMARY KEY (id),\n  KEY parent_id_idx (parent_id),\n  CONSTRAINT \\`child_parent_fk\\` FOREIGN KEY (parent_id) REFERENCES parent_table(id) ON DELETE NO ACTION\n);\n`)),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},\"In MySQL, foreign keys are only implemented by the storage engine layer, namely the default and popular InnoDB engine. A FOREIGN KEY constraint isn't a separate entity. It lives within the child's table space.\"),\" \",mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"FOREIGN KEY\"),\" constraints are available for row deletion (\",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE\"),\") and row updates (\",mdx(\"inlineCode\",{parentName:\"p\"},\"ON UPDATE\"),\"). In this document we discuss \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE\"),\" as it is the more impactful of the two. The discussion is relevant to \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON UPDATE\"),\" constraints, as well.\"),mdx(\"p\",null,\"Foreign keys further support three types of action (illustrated below for \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE\"),\"):\"),mdx(\"h3\",null,mdx(\"inlineCode\",{parentName:\"h3\"},\"ON DELETE CASCADE\")),mdx(\"p\",null,\"This is the most greedy, or ambitious action type. If you \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" a row from a parent table, any referencing rows in a child table are subsequently deleted within the same transaction. This operation runs recursively for all of a parent's children, as well as for their children, should they also employ \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE CASCADE\"),\".\"),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE CASCADE\"),\" is a risky and resource consuming action. You intend to \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" a single row, but end up deleting hundreds, thousands, or more, rows in multiple tables. What seemed like a simple transaction now turns into a massive operation, that involves excessive locking, increased MVCC overhead, impact on replication lag, and more.\"),mdx(\"p\",null,\"But perhaps the greatest danger is the potential unexpected loss of data. Whether an unsuspecting developer simply assumes a \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE FROM parent_table WHERE id=3\"),\" will at most delete one row, down to surprising behavior such as in \",mdx(\"inlineCode\",{parentName:\"p\"},\"REPLACE INTO\"),\" queries, which actually run an implicit \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\", leading to mass destruction of data.\"),mdx(\"p\",null,\"The use of \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE CASCADE\"),\" is controversial. Use it with great care. Consider using \",mdx(\"inlineCode\",{parentName:\"p\"},\"NO ACTION\"),\" instead.\"),mdx(\"h3\",null,mdx(\"inlineCode\",{parentName:\"h3\"},\"ON DELETE SET NULL\")),mdx(\"p\",null,\"With this setup, a \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" on a parent (e.g. \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE FROM parent_table WHERE id=3\"),\") will set the referencing column on children (e.g. \",mdx(\"inlineCode\",{parentName:\"p\"},\"parent_id\"),\" column in \",mdx(\"inlineCode\",{parentName:\"p\"},\"child_table\"),\") to \",mdx(\"inlineCode\",{parentName:\"p\"},\"NULL\"),\" for matching rows. It effectively leads to orphaned rows, not very differently from having no foreign key constraints at all.\"),mdx(\"p\",null,\"One advantage is that it's easy to identify the orphan rows: those, and only those rows, will have \",mdx(\"inlineCode\",{parentName:\"p\"},\"NULL\"),\" for parent-referencing columns.\"),mdx(\"p\",null,\"Like \",mdx(\"inlineCode\",{parentName:\"p\"},\"CASCADE\"),\", a single row deletion on the parent may lead to multiple rows updated on child tables. This again may cause large transactions, excessive locking, and replication lag.\"),mdx(\"h3\",null,mdx(\"inlineCode\",{parentName:\"h3\"},\"ON DELETE NO ACTION\")),mdx(\"p\",null,\"Possibly the single most important feature of foreign keys, a \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" on a parent will fail if child rows exist that reference the parent's row. To \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" a row from a parent, the app/user must first \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" the referencing rows from all children. Recursively, if those are further referenced by other tables, the app/user must first \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" rows from grandchildren, and so forth.\"),mdx(\"p\",null,\"This action (or lack thereof) type forces the app to have stronger ownership of its data. An app written to work with \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE NO ACTION\"),\" will organically evolve \",mdx(\"em\",{parentName:\"p\"},\"knowing\"),\" which tables reference which other tables, and will have established \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\"/\",mdx(\"inlineCode\",{parentName:\"p\"},\"UPDATE\"),\" flows that iterate through tables in the correct order so as to satisfy referential integrity.\"),mdx(\"h2\",null,\"How does your schema look without FOREIGN KEY constraints?\"),mdx(\"p\",null,\"The above schema would look exactly the same, minus the \",mdx(\"inlineCode\",{parentName:\"p\"},\"CONSTRAINT\"),\" clause:\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-sql\"}),`CREATE TABLE parent_table (\n  id INT NOT NULL,\n  PRIMARY KEY (id)\n);\n\nCREATE TABLE child_table (\n  id INT NOT NULL,\n  parent_id INT,\n  PRIMARY KEY (id),\n  KEY parent_id_idx (parent_id)\n);\n`)),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},\"Each FOREIGN KEY constraint requires an index covering the referenced column(s) on both sides of the connection. The index parent_id_idx is \",mdx(\"i\",null,\"required\"),\" by the constraint. We can drop that key in our constraint-free table, depending on the type of queries we might use to retrieve data from the tables.\"),\" \",mdx(\"h2\",null,\"Developing an app with no FOREIGN KEY constraints\"),mdx(\"p\",null,\"Consider an app's behavior in a \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE NO ACTION\"),\" setup again: the app \",mdx(\"em\",{parentName:\"p\"},\"knows\"),\" the tables dependencies, handles iteration order for \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\"/\",mdx(\"inlineCode\",{parentName:\"p\"},\"UPDATE\"),\". It does everything right.\"),mdx(\"p\",null,\"What happens if we take away the \",mdx(\"inlineCode\",{parentName:\"p\"},\"CONSTRAINT\"),\" at this point?\"),mdx(\"p\",null,\"The app remains unchanged. It already runs the proper actions in the proper order. The app operation that ends up running the \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE FROM parent_table WHERE id=3\"),\" succeeds the app operations that \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" the child table(s). While we lose the database's safety guarantee enforcing this behavior, we are perfectly capable of managing it on our own.\"),mdx(\"p\",null,\"Likewise, an app that grows with a constraint-less schema, organically learns to handle \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"UPDATE\"),\" scenarios. It is in fact given some extra freedom, because the \",mdx(\"em\",{parentName:\"p\"},\"order\"),\" of operations is not enforced. This is an advantage, because the app is not forced to \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" thousands of dependent rows for each parent row deletion \",mdx(\"em\",{parentName:\"p\"},\"at that same transaction\"),\". The app may well postpone deletion as we discuss shortly.\"),mdx(\"p\",null,\"Referential integrity is but one of many logical data integrity constraints, it just happens to be one that databases are able to enforce. Any sizeable application will maintain the integrity of its data with rules the database is unaware of.\"),mdx(\"h2\",null,\"Cleaning up orphaned rows\"),mdx(\"p\",null,\"Consider an \",mdx(\"inlineCode\",{parentName:\"p\"},\"ON DELETE SET NULL\"),\" constraint. What happens to the child rows that were set to \",mdx(\"inlineCode\",{parentName:\"p\"},\"NULL\"),\"? Typically, there is little or no damage in keeping them around. A query can, for example, \",mdx(\"inlineCode\",{parentName:\"p\"},\"SELECT\"),\" rows \",mdx(\"inlineCode\",{parentName:\"p\"},\"WHERE parent_id IS NOT NULL\"),\". Better yet, child rows are often \",mdx(\"inlineCode\",{parentName:\"p\"},\"JOIN\"),\"ed with their respective parent rows. Any query running such a \",mdx(\"inlineCode\",{parentName:\"p\"},\"JOIN\"),\" will return empty, since the parent row does not exist.\"),mdx(\"p\",null,\"Eventually, those rows will pile up, and you will want to reclaim the space.\"),mdx(\"p\",null,\"Without \",mdx(\"inlineCode\",{parentName:\"p\"},\"FOREIGN KEY\"),\" constraints, the situation is very much the same, It is possible to \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" a parent row without deleting its dependant children rows. A child row \",mdx(\"inlineCode\",{parentName:\"p\"},\"JOIN\"),\"ed with a respective (deleted) parent row comes out empty. There is no \",mdx(\"inlineCode\",{parentName:\"p\"},\"IS NOT NULL\"),\" to help you, but identifying those rows is still trivial. Similarly, there is little or no damage in keeping those rows around for a while.\"),mdx(\"p\",null,\"And similarly, those rows eventually pile up.\"),mdx(\"p\",null,\"A common practice, where appropriate, is to \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" rows on a parent table, or perhaps also on a subset of children, but leave some other tables for offline batch processing.\"),mdx(\"p\",null,\"At some convenient time, such as low traffic hours, the app or some batch job will purge orphaned rows. Consider this simplified query:\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-sql\"}),`DELETE FROM child_table LEFT JOIN parent_table ON (child_table.parent_id=parent_table.id) WHERE parent_table.id IS NULL\n`)),mdx(\"p\",null,\"A single \",mdx(\"inlineCode\",{parentName:\"p\"},\"DELETE\"),\" is likely a massive operation, which is to be avoided. A good practice is to break the statement into multiple small-scope statements, e.g. deleting \",mdx(\"inlineCode\",{parentName:\"p\"},\"100\"),\" rows at a time.\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"fields":{"slug":"tutorials/operating-without-foreign-keys","lastUpdatedOn":"2021-12-25T02:34:05.859Z"}},"__N_SSG":true},"page":"/[category]/[post]","query":{"category":"tutorials","post":"operating-without-foreign-keys"},"buildId":"-s0dJXBYWF7LmYhpsQySm","assetPrefix":"/docs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>