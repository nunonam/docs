{"pageProps":{"frontmatter":{"title":"Connect a Node.js app","subtitle":""},"headings":[{"depth":2,"value":"Introduction"},{"depth":2,"value":"Prerequisites"},{"depth":2,"value":"Set up the database"},{"depth":2,"value":"Set up the starter Node.js app"},{"depth":2,"value":"Connect to PlanetScale with Express.js"},{"depth":3,"value":"Using client certificates with the CLI"},{"depth":3,"value":"Using a connection string"},{"depth":2,"value":"What's next?"},{"depth":2,"value":"Need help?"}],"body":{"compiledSource":"var d=Object.defineProperty,h=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var r=Object.getOwnPropertySymbols;var s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable;var l=(a,t,n)=>t in a?d(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,e=(a,t)=>{for(var n in t||(t={}))s.call(t,n)&&l(a,n,t[n]);if(r)for(var n of r(t))p.call(t,n)&&l(a,n,t[n]);return a},i=(a,t)=>h(a,u(t));var c=(a,t)=>{var n={};for(var o in a)s.call(a,o)&&t.indexOf(o)<0&&(n[o]=a[o]);if(a!=null&&r)for(var o of r(a))t.indexOf(o)<0&&p.call(a,o)&&(n[o]=a[o]);return n};const makeShortcode=a=>function(n){return console.warn(\"Component \"+a+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",e({},n))},InfoBlock=makeShortcode(\"InfoBlock\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var o=n,{components:a}=o,t=c(o,[\"components\"]);return mdx(MDXLayout,i(e(e({},layoutProps),t),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"Introduction\"),mdx(\"p\",null,\"In this tutorial, you'll create a simple Node.js and Express.js application and connect it to a PlanetScale database.\"),mdx(\"h2\",null,\"Prerequisites\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://nodejs.org/en/download/\"}),\"Node.js\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/planetscale/cli\"}),\"PlanetScale CLI\")),mdx(\"li\",{parentName:\"ul\"},\"Authenticate the CLI with the following command:\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale auth login\n`)),mdx(\"h2\",null,\"Set up the database\"),mdx(\"p\",null,\"First, create a new database with the following command:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),`pscale database create <DATABASE_NAME>\n`)),mdx(\"p\",null,\"Next, let's add some data to the database. You'll create a new table called \",mdx(\"inlineCode\",{parentName:\"p\"},\"users\"),\" and add one record to it.\"),mdx(\"p\",null,\"To do this, use the PlanetScale CLI shell to open a MySQL shell where you can manipulate your database. You may need to \",mdx(\"a\",e({parentName:\"p\"},{href:\"/reference/planetscale-environment-setup\"}),\"install the MySQL command line client\"),\" if you haven't already.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),`pscale shell <DATABASE_NAME> <BRANCH_NAME>\n`)),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"A branch, \",mdx(\"inlineCode\",null,\"main\"),\", was automatically created when you created your database, so you can use that for \",mdx(\"inlineCode\",null,\"BRANCH_NAME\"),\".\"),mdx(\"p\",null,\"Create the \",mdx(\"inlineCode\",{parentName:\"p\"},\"users\"),\" table:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sql\"}),\"CREATE TABLE `users` (\\n  `id` int NOT NULL AUTO_INCREMENT PRIMARY KEY,\\n  `email` varchar(255) NOT NULL,\\n  `first_name` varchar(255),\\n  `last_name` varchar(255)\\n);\\n\")),mdx(\"p\",null,\"Then, add a record to it with:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sql\"}),\"INSERT INTO `users` (id, email, first_name, last_name)\\nVALUES  (1, 'hp@example.com', 'Harry', 'Potter');\\n\")),mdx(\"p\",null,\"You can verify it was added with:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sql\"}),`select * from users;\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`+----+----------------+------------+-----------+\n| id | email          | first_name | last_name |\n+----+----------------+------------+-----------+\n|  1 | hp@example.com | Harry      | Potter    |\n+----+----------------+------------+-----------+\n`)),mdx(\"p\",null,\"Next, you'll set up the Express starter application.\"),mdx(\"h2\",null,\"Set up the starter Node.js app\"),mdx(\"p\",null,\"Clone the starter repository:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),`git clone https://github.com/planetscale/express-example.git\n`)),mdx(\"p\",null,\"Enter into the folder and install the dependencies with:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),`cd express-example\nnpm install\n`)),mdx(\"p\",null,\"Now that your application is set up and the database is ready to be used, let's connect them.\"),mdx(\"h2\",null,\"Connect to PlanetScale with Express.js\"),mdx(\"p\",null,\"There are two ways to connect your Express application to your PlanetScale database: \",mdx(\"strong\",{parentName:\"p\"},\"using client certificates\"),\" or \",mdx(\"strong\",{parentName:\"p\"},\"using a connection string\"),\". Both options are covered below.\"),mdx(\"h3\",null,\"Using client certificates with the CLI\"),mdx(\"p\",null,\"Use the following command to create a connection to your database and start the application:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale connect <DATABASE_NAME> <BRANCH_NAME> --execute 'node app.js'\n`)),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"Running \",mdx(\"inlineCode\",null,\"pscale connect\"),\" with the execute flag will pass a \",mdx(\"inlineCode\",null,\"DATABASE_URL\"),\" to the Node application, enabling it to connect to PlanetScale. Don't forget to look in \",mdx(\"inlineCode\",null,\"app.js\"),\" to see how the DATABASE_URL is used.\"),mdx(\"p\",null,\"Navigate to \",mdx(\"a\",e({parentName:\"p\"},{href:\"http://localhost:3000\"}),\"http://localhost:3000\"),\" and you'll see the data from your \",mdx(\"inlineCode\",{parentName:\"p\"},\"users\"),\" table!\"),mdx(\"h3\",null,\"Using a connection string\"),mdx(\"p\",null,\"This section will show you how to create a username and password through the CLI to connect to your application. If you'd prefer to use the dashboard for this step, you can find those instructions in the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/concepts/connection-strings#creating-a-password\"}),\"Connection Strings documentation\"),\" and then come back here to finish setup.\"),mdx(\"p\",null,\"First, create your \",mdx(\"inlineCode\",{parentName:\"p\"},\".env\"),\" file by renaming the \",mdx(\"inlineCode\",{parentName:\"p\"},\"env.example\"),\" file to \",mdx(\"inlineCode\",{parentName:\"p\"},\".env\"),\":\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),`mv env.example .env\n`)),mdx(\"p\",null,\"Next, using the PlanetScale CLI, create a new username and password for the branch of your database:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`pscale password create <DATABASE_NAME> <BRANCH_NAME> <PASSWORD_NAME>\n`)),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"The \",mdx(\"inlineCode\",null,\"PASSWORD_NAME\"),' value represents the name of the username and password being generated. You can have multiple credentials for a branch, so this gives you a way to categorize them. To manage your passwords in the dashboard, go to your database overview page, click \"Settings\", and then click \"Passwords\".'),mdx(\"p\",null,\"Take note of the values returned to you, as you won't be able to see this password again.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`Password production-password was successfully created.\nPlease save the values below as they will not be shown again\n\n  NAME                  USERNAME       ACCESS HOST URL                     ROLE               PLAIN TEXT\n --------------------- -------------- ----------------------------------- ------------------ -------------------------------------------------------\n  production-password   jp71f987awnod   gxvhbzcxfw01.us-east-2.psdb.cloud   Can Read & Write   pscale_pw_sVkiE_mtfxQirc4qGZXMf098as90d8as0d98asd\n`)),mdx(\"p\",null,\"You'll use these values to construct your connection string, which will be the value for \",mdx(\"inlineCode\",{parentName:\"p\"},\"DATABASE_URL\"),\" in your \",mdx(\"inlineCode\",{parentName:\"p\"},\".env\"),\" file. Create your connection string in the following format:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`\"mysql://<USERNAME>:<PLAIN TEXT PASSWORD>@<ACCESS HOST URL>/<DATABASE_NAME>?ssl=true\"\n`)),mdx(\"p\",null,\"In the \",mdx(\"inlineCode\",{parentName:\"p\"},\".env\"),\" file, fill in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"DATABASE_URL\"),\" variable with the value you constructed. It should look something like this:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-env\"}),`DATABASE_URL=mysql://3e98edjddk:pscale_pw_wlksdjlkdc083892332jds@nd2298dss.us-east-3.psdb.cloud/express_database?ssl=true\n`)),mdx(\"p\",null,\"Finally, run your Express application with:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`node app.js\n`)),mdx(\"p\",null,\"Navigate to \",mdx(\"a\",e({parentName:\"p\"},{href:\"http://localhost:3000\"}),\"http://localhost:3000\"),\" and you'll see the data from your \",mdx(\"inlineCode\",{parentName:\"p\"},\"users\"),\" table!\"),mdx(\"h2\",null,\"What's next?\"),mdx(\"p\",null,\"Learn more about how PlanetScale allows you to make \",mdx(\"a\",e({parentName:\"p\"},{href:\"/concepts/nonblocking-schema-changes\"}),\"non-blocking schema changes\"),` to your database tables without locking or causing downtime for production databases. If you're interested in learning how to secure your application when connecting to PlanetScale,\nplease read `,mdx(\"a\",e({parentName:\"p\"},{href:\"/reference/planetscale-security\"}),\"Connecting to PlanetScale securely\"),\".\"),mdx(\"h2\",null,\"Need help?\"),mdx(\"p\",null,\"Get help from \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.planetscale.com/support\"}),\"PlanetScale's support team\"),\", or join our \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/planetscale/beta/discussions\"}),\"GitHub Discussion board\"),\" to see how others are using PlanetScale.\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"fields":{"slug":"tutorials/connect-nodejs-app","lastUpdatedOn":"2021-12-25T02:12:47.241Z"}},"__N_SSG":true}