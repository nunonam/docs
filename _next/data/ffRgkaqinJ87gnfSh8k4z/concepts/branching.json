{"pageProps":{"frontmatter":{"title":"Branching","subtitle":"Create a development or staging environment for your database through branches"},"headings":[{"depth":2,"value":"Overview"},{"depth":2,"value":"Development and production branches"},{"depth":2,"value":"Branch promotion "},{"depth":3,"value":"Promote the main database branch"},{"depth":3,"value":"Promote any development branch"},{"depth":2,"value":"Create a development branch"},{"depth":2,"value":"Deploy a branch"},{"depth":3,"value":"Create a deploy request"},{"depth":3,"value":"Review the schema diff "},{"depth":3,"value":"Add changes to the deploy queue"},{"depth":2,"value":"Set a default branch"},{"depth":2,"value":"Delete a branch"},{"depth":2,"value":"Resolve a schema conflict"},{"depth":2,"value":"Automatically copy migration data"},{"depth":2,"value":"Need help?"}],"body":{"compiledSource":"var l=Object.defineProperty,d=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var r=Object.getOwnPropertySymbols;var c=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable;var i=(e,a,t)=>a in e?l(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,o=(e,a)=>{for(var t in a||(a={}))c.call(a,t)&&i(e,t,a[t]);if(r)for(var t of r(a))p.call(a,t)&&i(e,t,a[t]);return e},h=(e,a)=>d(e,m(a));var s=(e,a)=>{var t={};for(var n in e)c.call(e,n)&&a.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&r)for(var n of r(e))a.indexOf(n)<0&&p.call(e,n)&&(t[n]=e[n]);return t};const makeShortcode=e=>function(t){return console.warn(\"Component \"+e+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",o({},t))},InfoBlock=makeShortcode(\"InfoBlock\"),NextBlock=makeShortcode(\"NextBlock\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var n=t,{components:e}=n,a=s(n,[\"components\"]);return mdx(MDXLayout,h(o(o({},layoutProps),a),{components:e,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"Overview\"),mdx(\"p\",null,\"PlanetScale allows you to branch databases schemas the way you branch your code. \"),mdx(\"p\",null,\"Development database branches are isolated copies of your database created with the current production schema. They can be used to develop features and test changes without impacting your production database. When you're ready, schema changes on a development branch can be safely applied to the production database using PlanetScale\\u2019s \",mdx(\"a\",o({parentName:\"p\"},{href:\"https://docs.planetscale.com/concepts/nonblocking-schema-changes\"}),\"non-blocking schema change workflow\"),\". This workflow ensures that your changes are deployed without blocking the database, locking individual tables, or slowing down production during the migration.\"),mdx(\"p\",null,mdx(\"img\",o({parentName:\"p\"},{src:\"/img/docs/ps_branching_diagram_light.png\",alt:\"PlanetScale Branching Flow Diagram\"}))),mdx(\"h2\",null,\"Development and production branches\"),mdx(\"p\",null,\"PlanetScale provides two types of database branches, \",mdx(\"em\",{parentName:\"p\"},\"development\"),\" branches and \",mdx(\"em\",{parentName:\"p\"},\"production\"),\" branches.\"),mdx(\"p\",null,\"Development branches provide isolated copies of your production database schema where you can make changes, experiment, or run CI.\"),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"Data from the main database is not copied to development branches.\"),mdx(\"p\",null,\"Production branches are highly available databases intended for production traffic. They are protected from direct schema changes by default and include automated daily backups.\"),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},\"You'll see a \",mdx(\"inlineCode\",null,\"ERROR 1105 (HY000): direct DDL is disabled\"),\" message if you attempt schema changes in a production branch. Create a development branch and start your changes there.\"),mdx(\"h2\",null,\"Branch promotion\"),mdx(\"p\",null,\"PlanetScale provides the ability to promote any development branch with a valid schema to production. Promoting a branch to production will require future schema changes to be made via a deploy request and will engage any custom backup schedules you have configured for production branches in addition to the automatic daily backups.\"),mdx(\"h3\",null,\"Promote the main database branch\"),mdx(\"p\",null,\"Every PlanetScale database is created with a development branch named \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\".\"),mdx(\"p\",null,\"This allows you to apply a schema directly to this branch, import data, and experiment with your database before promoting the branch to production. \"),mdx(\"p\",null,\"Once you are satisfied with the changes you have made to your \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\" branch, you can promote the \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\" branch to production. \"),mdx(\"p\",null,\"A branch can be promoted from the branch overview page in the PlanetScale app or you can use the command below to promote a branch using the \",mdx(\"a\",o({parentName:\"p\"},{href:\"https://docs.planetscale.com/reference/planetscale-cli\"}),\"PlanetScale CLI\"),\". \"),mdx(\"pre\",null,mdx(\"code\",o({parentName:\"pre\"},{className:\"language-zsh\"}),`pscale branch promote <database> <branch>\n`)),mdx(\"h3\",null,\"Promote any development branch\"),mdx(\"p\",null,\"Any PlanetScale development branch can be promoted to production. It's possible to run multiple production branches simultaneously, however it's important to note that PlanetScale does not provide data syncing between production branches.\"),mdx(\"p\",null,\"You can promote any development branch from the given branch overview page, or from the command line with \",mdx(\"inlineCode\",{parentName:\"p\"},\"pscale\"),\". \"),mdx(\"pre\",null,mdx(\"code\",o({parentName:\"pre\"},{className:\"language-zsh\"}),`pscale branch promote <database> <branch>\n`)),mdx(\"h2\",null,\"Create a development branch\"),mdx(\"p\",null,\"You can create a development branch from any production branch. Create a branch from the production branch overview page \",mdx(\"inlineCode\",{parentName:\"p\"},\"app.planetscale.com/<organization>/<database>/<branch>\"),\" or use the command below.\"),mdx(\"pre\",null,mdx(\"code\",o({parentName:\"pre\"},{className:\"language-zsh\"}),`pscale branch create <database> <branch>\n`)),mdx(\"h2\",null,\"Deploy a branch\"),mdx(\"p\",null,\"Once you are satisfied with the schema changes you have made on a branch, you can deploy your changes to production. \"),mdx(\"h3\",null,\"Create a deploy request\"),mdx(\"p\",null,\"The first step is to create a deploy request. If you are working in a team, the deploy request creates an opportunity for your teammates to review the changes you have made before they are deployed to production. \"),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"Administrators can require approval for deploy requests in the database's Settings tab.\"),mdx(\"p\",null,\"Create a deploy request from the branch overview page \",mdx(\"inlineCode\",{parentName:\"p\"},\"app.planetscale.com/<organization>/<database>/<branch>\"),\" or run the command below using the CLI.\"),mdx(\"pre\",null,mdx(\"code\",o({parentName:\"pre\"},{}),`pscale deploy-request create <database> <branch>\n`)),mdx(\"h3\",null,\"Review the schema diff\"),mdx(\"p\",null,\"The deploy request includes a schema diff that allows you to review the schema changes introduced by the deploy request. View the schema diff in the Schema tab in the PlanetScale app. \"),mdx(\"p\",null,\"You can also run the command below to see the schema diff in the CLI. \"),mdx(\"pre\",null,mdx(\"code\",o({parentName:\"pre\"},{className:\"language-zsh\"}),`pscale deploy-request diff <database> <deploy-request-number> \n`)),mdx(\"h3\",null,\"Add changes to the deploy queue\"),mdx(\"p\",null,\"Once a deploy request has been created (and approved, if required), you will need to add the changes to the deploy queue. Schema changes are deployed to a database in the order in which they are received. PlanetScale analyzes the schema changes in a deploy request when they are added to the deploy queue to ensure that the changes do not conflict with any of the queued schema changes. \"),mdx(\"p\",null,\"To add a deploy request to the deploy queue click on the button \\u201CAdd changes to the deploy queue\\u201D on the deploy request page. \"),mdx(\"p\",null,\"Alternatively, you can run the following command. \"),mdx(\"pre\",null,mdx(\"code\",o({parentName:\"pre\"},{className:\"language-zsh\"}),`pscale deploy-request deploy <database> <deploy-request-number>\n`)),mdx(\"p\",null,\"PlanetScale provides insight on the deploy queue, listing all of the schema changes in the queue with their completion status. \"),mdx(\"p\",null,mdx(\"img\",o({parentName:\"p\"},{src:\"/img/docs/branching-deploy-queue.png\",alt:\"Deploy queue\"}))),mdx(\"h2\",null,\"Set a default branch\"),mdx(\"p\",null,\"Each PlanetScale database with a production branch has a default branch that cannot be deleted. \"),mdx(\"p\",null,\"The first database branch that gets promoted to production is automatically set as the default branch for your database. \"),mdx(\"p\",null,\"However, this can be updated in the database Settings tab. Use the default branch dropdown menu to select the branch you would to set as default and click the Save database settings button to save your changes. \"),mdx(\"h2\",null,\"Delete a branch\"),mdx(\"p\",null,\"You can delete your branch either from the branches overview page \",mdx(\"inlineCode\",{parentName:\"p\"},\"app.planetscale.com/<organization>/<database>/branches\"),\" or run the following command in the CLI.\"),mdx(\"pre\",null,mdx(\"code\",o({parentName:\"pre\"},{className:\"language-zsh\"}),`pscale branch delete <database> <branch>\n`)),mdx(\"p\",null,\"We recommend deleting your branch once you have used it to merge a schema change, or if you are no longer using the branch for testing. You can always create a new branch from your production database. \"),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"Only organization administrators have permission to delete production branches.\"),mdx(\"h2\",null,\"Resolve a schema conflict\"),mdx(\"p\",null,\"Schema conflicts occur when your development branch has conflicting changes with the production branch. \"),mdx(\"p\",null,\"To resolve a schema conflict, create a new branch, which will have the most up-to-date schema, and apply the necesary schema changes to the new branch before repeating the deploy process. \"),mdx(\"h2\",null,\"Automatically copy migration data\"),mdx(\"p\",null,\"Many frameworks and migration tools keep track of data schema changes in a migration table. When turned on, PlanetScale will automatically copy migration table metadata from your \",mdx(\"inlineCode\",{parentName:\"p\"},\"development\"),\" branch to the \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\" branch as part of our deployment process.\"),mdx(\"p\",null,\"To turn on for your database, go to the web app:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Go into the Settings for your database\"),mdx(\"li\",{parentName:\"ol\"},'Enable \"Automatically copy migration data\"'),mdx(\"li\",{parentName:\"ol\"},\"Select one of the migration frameworks: Rails/Phoenix, Django, .NET, Prisma, Sequelize, or Other, which allows you to specify a custom table name\")),mdx(\"p\",null,\"You can see how this works in this \",mdx(\"a\",o({parentName:\"p\"},{href:\"/tutorial/automatic-rails-migrations\"}),\"Rails migration tutorial\"),\".\"),mdx(\"h2\",null,\"Need help?\"),mdx(\"p\",null,\"Get help from \",mdx(\"a\",o({parentName:\"p\"},{href:\"https://www.planetscale.com/support\"}),\"PlanetScale's support team\"),\", or join our \",mdx(\"a\",o({parentName:\"p\"},{href:\"https://github.com/planetscale/beta/discussions\"}),\"GitHub discussion board\"),\" to see how others are using PlanetScale.\"),mdx(NextBlock,{steps:[{text:\"Non-blocking schema changes\",link:\"/concepts/nonblocking-schema-changes\"},{text:\"Regions\",link:\"/concepts/regions\"}],mdxType:\"NextBlock\"}))}MDXContent.isMDXComponent=!0;\n","scope":{}},"fields":{"slug":"concepts/branching","lastUpdatedOn":"2021-12-25T04:33:55.511Z"}},"__N_SSG":true}